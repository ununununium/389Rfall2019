# Writeup 8 - Binaries II

Name: *Yuting Zhong*
Section: *0101*

I pledge on my honor that I have not given or received any unauthorized assistance on this assignment or examination.

Digital acknowledgement: *Yuting Zhong*

## Assignment Writeup

### Part 1 (100 pts)
Answer the following questions regarding the server executable (for which source is provided).

1. How is the per-session administrator password generated? Are there any inherent weaknesses in this implementation?

  The per-session administrator password is generated by the seed of time. The weakness is if the hacker knows when the exact time victim access the server, the hacker would be able to generate that password.  

2. Describe two vulnerabilities in this program. Provide specific line numbers and classifications of the vulnerability. Explain potential ramifications as well as ways to avoid these vulnerabilities when writing code.
  - ```server.c[46]``` ```Format String vulnerability```. If user input string is ```"%p"```, the ```printf()``` will print the address on the stack. The number of ``"%p"`` user passed in will be the same as the number of addresses ```printf()``` will spit out. Once you have this ability to what is going on on the stack, you can basically see any thing from this program. To avoid this vulnerability, you should specify ```"%s"``` as your format string.

  - ```server.c[68]``` ```Buffer Overflow vulnerability```. If the user load some thing that is bigger than the size of the allocated buffer, user will be able to change something on the stack. To avoid this vulnerability, simply never use ```gets``` in you program. Because it will not check the size of the input and directly load the input to the buffer.

3. What is the flag?  ```CMSC389R-{expl017-2-w1n}```  

4. Describe the process you followed to obtain the flag: vulnerabilities exploited, your inputs to the server in a human-readable format, etc. If you create any helper code please include it.
  1. Generate the password. From the server code, we know that the password is generated by a random seed associated with the time you run the server program. So I copied some lines of code form server.c to create the password generation program called ```password_generator.c``` and the compiled the executable file ```pwd_gen``` This program will be execute at the same time when you access the server. I test my code locally by using the command ```./pwd_gen ; ./server```. It turns out that my password is right and I got privilege elevated. However, when I tried the same method on the server by using ```./pwd_gen ; nc ec2-18-222-89-163.us-east-2.compute.amazonaws.com 1337 ``` I got password failed. That is because there is some time delay between I execute the command and actually run the server program remotely. To solve this problem, I wrote a python script ```crack.py```. This will run ```pwd_gen``` after connecting to the server.

  2. After privilege elevated, the next step is to exploit buffer overflow. From the server source code, I know that the size of buffer is 32+1 = 33, size of  "cat flag" is 8. To cause buffer overflow, I have to add 25 more spaces to let the size of my input string greater than the size of buff. So the command I need to run on the server is ```'cat flag' + ' '*25 + 'cat flag' + ' '*25```
